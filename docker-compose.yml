services:
  jmeter:
    image: justb4/jmeter:5.5
    container_name: jmeter_runner
    platform: linux/amd64
    volumes:
      - ./tests/jmeter:/tests   # tudo aqui vira /tests
      - ./results:/results
    entrypoint:
      - sh
      - -c
      - |
        echo "ğŸ” Arquivos em /tests:"
        ls -la /tests/

        echo "ğŸ” ConteÃºdo do credenciais.csv:"
        cat /tests/credenciais.csv || echo "âŒ Arquivo nÃ£o encontrado!"

        rm -f /results/result.jtl
        rm -rf /results/html-report
        mkdir -p /results

        jmeter -n \
          -t /tests/Demo-Shop-Performance-Test.jmx \
          -l /results/result.jtl \
          -e -o /results/html-report \
          -Jjmeter.save.saveservice.output_format=csv

  k6:
    image: grafana/k6:0.54.0
    container_name: k6_runner
    volumes:
      - ./tests/k6/dist:/scripts
      - ./results:/results
    working_dir: /scripts
    command: ["run", "main.js", "--summary-export=/results/k6-summary.json"]
    # Para CI: usar --out influxdb=http://influx:8086/k6
